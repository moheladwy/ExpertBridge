<div class="border-l-4 border-gray-200 pl-3 py-2 mb-3 @(CommentResponse?.ParentCommentId == null ? "" : "ml-6")">
    @if (CommentResponse != null)
    {
        <div class="flex items-start gap-3">
            <div class="flex-shrink-0">
                @if (CommentResponse.Author?.ProfilePictureUrl != null)
                {
                    <img src="@CommentResponse.Author.ProfilePictureUrl" alt="@CommentResponse.Author.FirstName's profile"
                         class="w-8 h-8 rounded-full object-cover"/>
                }
                else
                {
                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 text-sm">
                        @(CommentResponse.Author != null ? CommentResponse.Author.FirstName[0].ToString().ToUpper() : "?")
                    </div>
                }
            </div>

            <div class="flex-1">
                <div class="flex flex-wrap items-baseline gap-2 mb-1">
                    @if (CommentResponse.Author != null)
                    {
                        <span class="font-medium text-gray-900">
                            @CommentResponse.Author.FirstName @CommentResponse.Author.LastName
                        </span>
                        @if (!string.IsNullOrEmpty(CommentResponse.Author.Username))
                        {
                            <span class="text-sm text-gray-500">@("@" + CommentResponse.Author.Username)</span>
                        }
                    }
                    else
                    {
                        <span class="font-medium text-gray-900">Anonymous</span>
                    }
                    <span class="text-xs text-gray-500">
                        @CommentResponse.CreatedAt.ToString("MMM dd â€¢ h:mm tt")
                    </span>
                </div>

                <div class="text-gray-700 mb-2">@CommentResponse.Content</div>

                @if (CommentResponse.Medias != null && CommentResponse.Medias.Any())
                {
                    <div class="grid @(CommentResponse.Medias.Count == 1 ? "" : "grid-cols-2") gap-2 mb-3">
                        @foreach (var media in CommentResponse.Medias)
                        {
                            @if (media.Type.StartsWith("image"))
                            {
                                <img src="@media.Url" alt="@media.Name" class="rounded-lg w-full h-auto object-cover" />
                            }
                            else if (media.Type.StartsWith("video"))
                            {
                                <video src="@media.Url" controls class="rounded-lg w-full">
                                    Your browser does not support the video tag.
                                </video>
                            }
                            else
                            {
                                <div class="flex items-center gap-2 p-2 rounded-lg border border-gray-200">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <a href="@media.Url" target="_blank" class="text-sm text-blue-600 hover:underline">@media.Name</a>
                                </div>
                            }
                        }
                    </div>
                }

                <div class="flex items-center gap-3 mt-1">
                    <button class="flex items-center gap-1 @(CommentResponse.IsUpvoted ? "text-blue-600" : "text-gray-500") hover:text-blue-600 text-sm">
                        <svg class="w-4 h-4" fill="@(CommentResponse.IsUpvoted ? "currentColor" : "none")" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                        <span>@CommentResponse.Upvotes</span>
                    </button>

                    <button class="flex items-center gap-1 @(CommentResponse.IsDownvoted ? "text-red-600" : "text-gray-500") hover:text-red-600 text-sm">
                        <svg class="w-4 h-4" fill="@(CommentResponse.IsDownvoted ? "currentColor" : "none")" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                        <span>@CommentResponse.Downvotes</span>
                    </button>

                    <button class="text-sm text-gray-500 hover:text-gray-700">Reply</button>
                </div>

                @if (CommentResponse.Replies != null && CommentResponse.Replies.Any())
                {
                    <div class="mt-3">
                        @foreach (var reply in CommentResponse.Replies)
                        {
                            <Comment CommentResponse="reply" />
                        }
                    </div>
                }
            </div>
        </div>
    }
    else
    {
        <div class="animate-pulse flex items-start gap-3">
            <div class="bg-gray-200 rounded-full h-8 w-8 flex-shrink-0"></div>
            <div class="flex-1">
                <div class="h-3 bg-gray-200 rounded w-1/4 mb-2"></div>
                <div class="h-12 bg-gray-200 rounded mb-2"></div>
                <div class="flex gap-2">
                    <div class="h-4 bg-gray-200 rounded w-10"></div>
                    <div class="h-4 bg-gray-200 rounded w-10"></div>
                </div>
            </div>
        </div>
    }
</div>
