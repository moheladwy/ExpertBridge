@page "/dashboard/content"

<PageTitle>Content Dashboard - ExpertBridge Admin</PageTitle>

<RadzenStack Gap="1.5rem">
    <RadzenRow>
        <RadzenColumn Size="12">
            <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween"
                         AlignItems="AlignItems.Center">
                <RadzenStack Gap="0.5rem">
                    <RadzenText TextStyle="TextStyle.H3" class="rz-font-weight-bold">
                        Content Dashboard
                    </RadzenText>
                    <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">
                        Posts, job postings, and comments analytics
                    </RadzenText>
                </RadzenStack>
                <RadzenButton Icon="refresh" ButtonStyle="ButtonStyle.Light" Size="ButtonSize.Large"
                              Click="@RefreshData" Disabled="@_loading" title="Refresh Data"/>
            </RadzenStack>
        </RadzenColumn>
    </RadzenRow>

    @if (_loading)
    {
        <RadzenStack AlignItems="AlignItems.Center" Gap="1rem" Style="padding: 4rem 0;">
            <RadzenProgressBarCircular ShowValue="false" Mode="ProgressBarMode.Indeterminate"
                                       Size="ProgressBarCircularSize.Large"/>
            <RadzenText TextStyle="TextStyle.Body1" class="rz-color-secondary">Loading content data...</RadzenText>
        </RadzenStack>
    }
    else
    {
        <!-- Summary Cards -->
        <RadzenRow Gap="1rem">
            <RadzenColumn Size="12" SizeMD="4">
                <RadzenCard Style="height: 100%;">
                    <RadzenStack Gap="0.5rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                                     JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Overline" class="rz-color-secondary">POSTS</RadzenText>
                            <RadzenIcon Icon="article" Style="color: var(--rz-success);"/>
                        </RadzenStack>
                        <RadzenText TextStyle="TextStyle.H4" class="rz-font-weight-bold">@_stats.TotalPosts</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">
                            @_stats.ActivePosts active • @_stats.DeletedPosts deleted
                        </RadzenText>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <RadzenColumn Size="12" SizeMD="4">
                <RadzenCard Style="height: 100%;">
                    <RadzenStack Gap="0.5rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                                     JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Overline" class="rz-color-secondary">COMMENTS</RadzenText>
                            <RadzenIcon Icon="chat_bubble" Style="color: var(--rz-info);"/>
                        </RadzenStack>
                        <RadzenText TextStyle="TextStyle.H4"
                                    class="rz-font-weight-bold">@_stats.TotalComments</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">
                            @_stats.ActiveComments active • @_stats.DeletedComments deleted
                        </RadzenText>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <RadzenColumn Size="12" SizeMD="4">
                <RadzenCard Style="height: 100%;">
                    <RadzenStack Gap="0.5rem">
                        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                                     JustifyContent="JustifyContent.SpaceBetween">
                            <RadzenText TextStyle="TextStyle.Overline" class="rz-color-secondary">JOB POSTINGS
                            </RadzenText>
                            <RadzenIcon Icon="work" Style="color: var(--rz-warning);"/>
                        </RadzenStack>
                        <RadzenText TextStyle="TextStyle.H4"
                                    class="rz-font-weight-bold">@_stats.TotalJobPostings</RadzenText>
                        <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">
                            @_stats.ActiveJobPostings active • @_stats.DeletedJobPostings deleted
                        </RadzenText>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>

        <!-- Charts Row 1: Posts and Comments -->
        <RadzenRow Gap="1rem">
            <RadzenColumn Size="12" SizeMD="6">
                <RadzenCard Style="height: 450px;">
                    <RadzenStack AlignItems="AlignItems.Center" Gap="1rem" Style="height: 100%;">
                        <RadzenText TextStyle="TextStyle.H6" class="rz-font-weight-bold">Post Distribution</RadzenText>
                        <RadzenStack Style="width: 100%; max-width: 400px;">
                            <RadzenChart>
                                <RadzenDonutSeries Data="@_postChartData" CategoryProperty="Category"
                                                   ValueProperty="Value"
                                                   Fills="@(new[] { "var(--rz-success)", "var(--rz-danger)" })">
                                    <ChildContent>
                                        <RadzenSeriesDataLabels Visible="@_showDataLabels"/>
                                    </ChildContent>
                                    <TitleTemplate>
                                        <div class="rz-donut-content">
                                            <div style="font-size: 2rem; font-weight: bold;">@_stats.TotalPosts</div>
                                            <div style="font-size: 0.875rem; color: var(--rz-text-secondary-color);">
                                                Total Posts
                                            </div>
                                        </div>
                                    </TitleTemplate>
                                </RadzenDonutSeries>
                            </RadzenChart>
                        </RadzenStack>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <RadzenColumn Size="12" SizeMD="6">
                <RadzenCard Style="height: 450px;">
                    <RadzenStack AlignItems="AlignItems.Center" Gap="1rem" Style="height: 100%;">
                        <RadzenText TextStyle="TextStyle.H6" class="rz-font-weight-bold">Comment Distribution
                        </RadzenText>
                        <RadzenStack Style="width: 100%; max-width: 400px;">
                            <RadzenChart>
                                <RadzenDonutSeries Data="@_commentChartData" CategoryProperty="Category"
                                                   ValueProperty="Value"
                                                   Fills="@(new[] { "var(--rz-info)", "var(--rz-danger)" })">
                                    <ChildContent>
                                        <RadzenSeriesDataLabels Visible="@_showDataLabels"/>
                                    </ChildContent>
                                    <TitleTemplate>
                                        <div class="rz-donut-content">
                                            <div style="font-size: 2rem; font-weight: bold;">@_stats.TotalComments</div>
                                            <div style="font-size: 0.875rem; color: var(--rz-text-secondary-color);">
                                                Total Comments
                                            </div>
                                        </div>
                                    </TitleTemplate>
                                </RadzenDonutSeries>
                            </RadzenChart>
                        </RadzenStack>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>

        <!-- Charts Row 2: Job Postings -->
        <RadzenRow Gap="1rem">
            <RadzenColumn Size="12" SizeMD="6">
                <RadzenCard Style="height: 450px;">
                    <RadzenStack AlignItems="AlignItems.Center" Gap="1rem" Style="height: 100%;">
                        <RadzenText TextStyle="TextStyle.H6" class="rz-font-weight-bold">Job Posting Distribution
                        </RadzenText>
                        <RadzenStack Style="width: 100%; max-width: 400px;">
                            <RadzenChart>
                                <RadzenDonutSeries Data="@_jobPostingChartData" CategoryProperty="Category"
                                                   ValueProperty="Value"
                                                   Fills="@(new[] { "var(--rz-warning)", "var(--rz-danger)" })">
                                    <ChildContent>
                                        <RadzenSeriesDataLabels Visible="@_showDataLabels"/>
                                    </ChildContent>
                                    <TitleTemplate>
                                        <div class="rz-donut-content">
                                            <div
                                                style="font-size: 2rem; font-weight: bold;">@_stats.TotalJobPostings</div>
                                            <div style="font-size: 0.875rem; color: var(--rz-text-secondary-color);">
                                                Total Job Postings
                                            </div>
                                        </div>
                                    </TitleTemplate>
                                </RadzenDonutSeries>
                            </RadzenChart>
                        </RadzenStack>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>

            <RadzenColumn Size="12" SizeMD="6">
                <RadzenCard Style="height: 450px;">
                    <RadzenStack Gap="1rem" Style="height: 100%; justify-content: center;">
                        <RadzenText TextStyle="TextStyle.H6" class="rz-font-weight-bold" Style="text-align: center;">
                            Content Statistics Summary
                        </RadzenText>
                        <RadzenStack Gap="1rem" Style="padding: 1rem;">
                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenIcon Icon="article" Style="color: var(--rz-success);"/>
                                    <RadzenText TextStyle="TextStyle.Body1">Posts</RadzenText>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenBadge BadgeStyle="BadgeStyle.Success" Text="@_stats.ActivePosts.ToString()"
                                                 Shade="Shade.Lighter"/>
                                    <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">active
                                    </RadzenText>
                                </RadzenStack>
                            </RadzenStack>

                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenIcon Icon="chat_bubble" Style="color: var(--rz-info);"/>
                                    <RadzenText TextStyle="TextStyle.Body1">Comments</RadzenText>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenBadge BadgeStyle="BadgeStyle.Info" Text="@_stats.ActiveComments.ToString()"
                                                 Shade="Shade.Lighter"/>
                                    <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">active
                                    </RadzenText>
                                </RadzenStack>
                            </RadzenStack>

                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenIcon Icon="work" Style="color: var(--rz-warning);"/>
                                    <RadzenText TextStyle="TextStyle.Body1">Job Postings</RadzenText>
                                </RadzenStack>
                                <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                             AlignItems="AlignItems.Center">
                                    <RadzenBadge BadgeStyle="BadgeStyle.Warning"
                                                 Text="@_stats.ActiveJobPostings.ToString()" Shade="Shade.Lighter"/>
                                    <RadzenText TextStyle="TextStyle.Body2" class="rz-color-secondary">active
                                    </RadzenText>
                                </RadzenStack>
                            </RadzenStack>

                            <div style="border-top: 1px solid var(--rz-border-color); margin: 0.5rem 0;"></div>

                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenText TextStyle="TextStyle.Body1" class="rz-font-weight-bold">Avg Comments per
                                    Post
                                </RadzenText>
                                <RadzenBadge BadgeStyle="BadgeStyle.Light"
                                             Text="@(_stats.ActivePosts > 0 ? (_stats.ActiveComments / (double)_stats.ActivePosts).ToString("F2") : "0")"/>
                            </RadzenStack>

                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenText TextStyle="TextStyle.Body1" class="rz-font-weight-bold">Total Content
                                    Items
                                </RadzenText>
                                <RadzenBadge BadgeStyle="BadgeStyle.Primary"
                                             Text="@((_stats.TotalPosts + _stats.TotalComments + _stats.TotalJobPostings).ToString())"
                                             Shade="Shade.Lighter"/>
                            </RadzenStack>

                            <RadzenStack Orientation="Orientation.Horizontal"
                                         JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                                <RadzenText TextStyle="TextStyle.Body1" class="rz-font-weight-bold">Total Active
                                    Content
                                </RadzenText>
                                <RadzenBadge BadgeStyle="BadgeStyle.Success"
                                             Text="@((_stats.ActivePosts + _stats.ActiveComments + _stats.ActiveJobPostings).ToString())"
                                             Shade="Shade.Lighter"/>
                            </RadzenStack>
                        </RadzenStack>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>

        <!-- Overview Chart: All Content -->
        <RadzenRow>
            <RadzenColumn Size="12">
                <RadzenCard>
                    <RadzenStack Gap="1rem">
                        <RadzenText TextStyle="TextStyle.H6" class="rz-font-weight-bold">Content Overview - Active vs
                            Deleted
                        </RadzenText>
                        <RadzenChart Style="height: 400px;">
                            <RadzenColumnSeries Data="@_overviewChartData" CategoryProperty="Category"
                                                ValueProperty="Active" Title="Active" Fill="var(--rz-success)"/>
                            <RadzenColumnSeries Data="@_overviewChartData" CategoryProperty="Category"
                                                ValueProperty="Deleted" Title="Deleted" Fill="var(--rz-danger)"/>
                            <RadzenCategoryAxis Padding="20"/>
                            <RadzenValueAxis>
                                <RadzenGridLines Visible="true"/>
                            </RadzenValueAxis>
                            <RadzenColumnOptions Radius="5"/>
                            <RadzenLegend Position="LegendPosition.Top"/>
                        </RadzenChart>
                    </RadzenStack>
                </RadzenCard>
            </RadzenColumn>
        </RadzenRow>
    }
</RadzenStack>
