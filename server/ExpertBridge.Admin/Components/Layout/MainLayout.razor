@using ExpertBridge.Admin.Database
@using Microsoft.AspNetCore.Identity
@inherits LayoutComponentBase
@inject ThemeService ThemeService
@inject SignInManager<Admin> SignInManager

<RadzenComponents @rendermode="InteractiveServer"/>


<RadzenLayout
    Style="grid-template-areas: 'rz-header rz-header' 'rz-sidebar rz-body' 'rz-sidebar rz-footer'">

    <RadzenHeader Style="display: flex ;justify-content: start">
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End"
                     AlignItems="AlignItems.Center" Gap="1rem">
            <RadzenSidebarToggle Click="@(() => sidebarExpanded = !sidebarExpanded)" class="rz-m-0"/>
            <RadzenAppearanceToggle/>
        </RadzenStack>
        <RadzenStack Style="margin: 1rem;" Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Start"
                     AlignItems="AlignItems.Center">
            <RadzenLink
                Text="Expert Bridge Admin Site"
                Path="https://admin.expertbridge.duckdns.org" Target="_blank" Icon="home"
                Style="font-size: 1rem;"/>
        </RadzenStack>
    </RadzenHeader>

    <RadzenSidebar @bind-Expanded="@sidebarExpanded">
        <RadzenPanelMenu>
            <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Expanded="true">
                <RadzenPanelMenuItem Text="Users & Profiles" Icon="people" Path="/"/>
                <RadzenPanelMenuItem Text="Content" Icon="article" Path="/dashboard/content"/>
                <RadzenPanelMenuItem Text="Tags" Icon="label" Path="/dashboard/tags"/>
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Content" Icon="library_books" Expanded="false">
                <RadzenPanelMenuItem Text="User Profiles" Icon="account_circle" Path="/user-profiles"/>
                <RadzenPanelMenuItem Text="Posts" Icon="article" Path="/posts"/>
                <RadzenPanelMenuItem Text="Job Posts" Icon="article" Path="/job-posts"/>
                <RadzenPanelMenuItem Text="Comments" Icon="chat_bubble" Path="/comments"/>
                <RadzenPanelMenuItem Text="All Tags" Icon="tag" Path="/post-tags"/>
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Moderation" Icon="report" Expanded="false">
                <RadzenPanelMenuItem Text="Moderation Reports" Icon="report_problem" Path="/moderation-reports"/>
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Deleted Content" Icon="delete" Expanded="false">
                <RadzenPanelMenuItem Text="Deleted Profiles" Icon="person_off" Path="/deleted-profiles"/>
                <RadzenPanelMenuItem Text="Deleted Posts" Icon="article" Path="/deleted-posts"/>
                <RadzenPanelMenuItem Text="Deleted Job Posts" Icon="article" Path="/deleted-job-posts"/>
                <RadzenPanelMenuItem Text="Deleted Comments" Icon="chat_bubble" Path="/deleted-comments"/>
            </RadzenPanelMenuItem>
            <RadzenPanelMenuItem Text="Account Management" Icon="manage_accounts" Expanded="false">
                <RadzenPanelMenuItem Text="Profile" Icon="person" Path="/Account/Manage"/>
                <RadzenPanelMenuItem Text="Email" Icon="email" Path="/Account/Manage/Email"/>
                <RadzenPanelMenuItem Text="Password" Icon="lock" Path="/Account/Manage/ChangePassword"/>
                @if (hasExternalLogins)
                {
                    <RadzenPanelMenuItem Text="External logins" Icon="login" Path="/Account/Manage/ExternalLogins"/>
                }
                <RadzenPanelMenuItem Text="Two-factor authentication" Icon="security"
                                     Path="/Account/Manage/TwoFactorAuthentication"/>
                <RadzenPanelMenuItem Text="Personal data" Icon="folder_shared" Path="/Account/Manage/PersonalData"/>
            </RadzenPanelMenuItem>
        </RadzenPanelMenu>
    </RadzenSidebar>

    <RadzenBody Style="overflow: auto">
        @Body
    </RadzenBody>

    <RadzenFooter Style="text-align: center;">
        <span>Copyright © @DateTime.Now.Year, Expert Bridge. All rights reserved.</span>
    </RadzenFooter>
</RadzenLayout>

@code {
    bool sidebarExpanded = true;
    private bool hasExternalLogins;

    protected override async Task OnInitializedAsync()
    {
        hasExternalLogins = (await SignInManager.GetExternalAuthenticationSchemesAsync()).Any();
    }

}
